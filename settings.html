<!DOCTYPE html>
<html>
	<head>
		<base target="_top" />
		<link
			rel="stylesheet"
			href="https://ssl.gstatic.com/docs/script/css/add-ons1.css"
		/>
		<style>
			input[type="text"],
			input[type="password"] {
				width: 100%;
			}
		</style>
	</head>
	<body>
		<div class="sidebar">
			<form>
				<div class="block form-group">
					<label for="table-name">Table name *</label>
					<input
						name="tableName"
						type="text"
						id="table-name"
						value="<?= settings.tableName ?>"
						onkeyup="validate(this)"
					/>
					<div class="error" style="display: none">
						<small>This is a required field</small>
					</div>
				</div>

				<div class="block form-group">
					<label for="base-id">Base ID *</label>
					<input
						name="baseId"
						type="text"
						id="base-id"
						value="<?= settings.baseId ?>"
						onkeyup="validate(this)"
					/>
					<div class="error" style="display: none">
						<small>This is a required field</small>
					</div>
				</div>

				<div class="block form-group">
					<label for="api-key">Api Key *</label>
					<input
						name="apiKey"
						type="password"
						id="api-key"
						value="<?= settings.apiKey ?>"
						onkeyup="validate(this)"
					/>
					<div class="error" style="display: none">
						<small>This is a required field</small>
					</div>
				</div>

				<div class="block form-group">
					<input type="submit" class="action" value="Save" />
				</div>
				<div class="block form-group">
					<a href="https://airtable.com/"><small>Airtable</small></a> -
					<a href="https://airtable.com/api"><small>Airtable API</small></a> -
					<a href="https://youtube.com/ashtonfei"><small>Ashton Fei</small></a>
				</div>
			</form>
		</div>

		<script>
			function validate(target) {
				if (target.value) {
					target.nextElementSibling.style.display = "none";
					return true;
				} else {
					target.nextElementSibling.style.display = "block";
					return false;
				}
			}

			function saveSettings(e) {
				e.preventDefault();
				const isValidTableName = validate(form.tableName);
				const isValidBaseId = validate(form.baseId);
				const isValidApiKey = validate(form.apiKey);

				if (isValidTableName && isValidBaseId && isValidApiKey) {
					const data = {
						tableName: form.tableName.value,
						baseId: form.baseId.value,
						apiKey: form.apiKey.value,
					};
					google.script.run
						.withSuccessHandler(() => {
							alert("Saved");
						})
						.withFailureHandler((error) => {
							alert(error.message);
						})
						.saveSettings(data);
				}
			}

			const form = document.forms[0];
			form.addEventListener("submit", saveSettings);
		</script>
	</body>
</html>
