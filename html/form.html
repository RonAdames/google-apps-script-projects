<template v-if=" app.session === form.start.session ">
    <div 
        class="md-content md-layout md-alignment-center-left"
        :style="form.start.style">
        <div class="md-layout-item md-size-50 md-medium-60 md-small-70 md-xsmall-size-95">
            <div class="md-title" v-html="form.start.title"></div>
            <div class="sub-head" style="margin-bottom: 24px;" v-html="form.start.subTitle"></div>
            <div>
                <md-button 
                    class="md-primary md-raised"
                    :disabled="!form.visible"
                    @click="goToSession(form.start.next)">
                        {{form.start.startButtonName}}
                        <md-icon v-if="form.start.startButtonIcon">{{form.start.startButtonIcon}}</md-icon>
                    </md-button>
            </div>
            <div v-if="form.validFrom">
                <small>
                    <span>This form is only available from {{new Date(form.validFrom).toLocaleString()}}</span>
                    <span v-if="form.validTo"> to {{new Date(form.validTo).toLocaleString()}}</span>.
                </small>
            </div>
        </div>
    </div>
</template>


<template v-if=" app.session === form.end.session && form.visible">
    <div 
        class="md-content md-layout md-alignment-center-left"
        :style="form.end.style">
        <div class="md-layout-item md-size-50 md-medium-60 md-small-70 md-xsmall-size-95">
            <div class="md-title" v-html="form.end.title"></div>
            <div v-html="form.end.message"></div>
            <div>
                <md-button 
                    class="md-primary md-raised"
                    @click="goToSession(form.start.session)">
                        {{form.end.endButtonName}}
                        <md-icon v-if="form.end.endButtonIcon">{{form.end.endButtonIcon}}</md-icon>
                    </md-button>
            </div>
        </div>
    </div>
</template>

<template v-for="(item, i) in form.items">
    <div 
        class="md-content md-layout md-alignment-center-left"
        :style="item.style"
        v-if=" app.session === i && form.visible" 
        :key=" 'form-item-' + i ">
        <div class="md-layout-item md-size-50 md-medium-60 md-small-70 md-xsmall-size-95">
            <div class="md-title">{{i+1}}. {{item.title}} <small v-if="item.required">*</small></div>
            <div class="sub-head">{{item.description}}</div>
            
            <md-field 
                v-if=" item.type === 'input' "
                :class=" item.valid === false ? 'md-invalid' : '' ">
                <md-input
                    :disabled="app.submitting"
                    :required="item.required"
                    :placeholder="item.placeholder"
                    v-model.trim="item.value"
                    @blur="validateForm(item)"
                    @keyup="validateForm(item)">
                </md-input>
                <span class="md-error">{{item.error}}</span>
            </md-field>

            <md-field 
                v-else-if=" item.type === 'textarea' "
                :class=" item.valid === false ? 'md-invalid' : '' ">
                <md-textarea
                    :disabled="app.submitting"
                    :required="item.required"
                    :placeholder="item.placeholder" 
                    v-model.trim="item.value"
                    @blur="validateForm(item)"
                    @keyup="validateForm(item)"
                    md-autogrow></md-textarea>
                <span class="md-error">{{item.error}}</span>
            </md-field>

            <div v-else-if=" item.type === 'date' ">
                <md-datepicker
                    :disabled="app.submitting"
                    :required="item.required"
                    v-model="item.value"
                    @input="validateForm(item)"
                    :class=" item.valid === false ? 'md-invalid' : '' "
                    :md-debounce="100"
                    md-immediately>
                    <span class="md-error">{{item.error}}</span>
                </md-datepicker>
            </div>
            
            <div v-else-if=" item.type === 'radio' ">
                <md-radio
                    v-for="(option, i) in item.options"
                    :key=" 'radio-' + i "
                    :value="option"
                    v-model="item.value"
                    :disabled="app.submitting"
                    @blur="validateForm(item)"
                    @change="validateForm(item)">
                    {{option}}
                </md-radio>
                <span class="error" v-if="item.valid === false">{{item.error}}</span>
            </div>
            
            <div v-else-if=" item.type === 'checkbox' ">
                <md-checkbox
                    v-for="(option, i) in item.options"
                    :key=" 'checkbox-' + i "
                    :value="option"
                    v-model="item.value"
                    :disabled="app.submitting"
                    @blur="validateForm(item)"
                    @change="validateForm(item)">
                    {{option}}
                </md-checkbox>
                <span class="error" v-if="item.valid === false">{{item.error}}</span>
            </div>
        
            <div>
                <template v-if=" i === form.items.length - 1 ">
                    <md-button
                        v-if="!app.submitting"
                        class="md-raised"
                        :disabled="app.submitting"
                        @click="goToSession(i - 1)">
                        <md-icon>chevron_left</md-icon>
                    </md-button>
                    <md-button
                        class="md-raised md-primary"
                        :disabled="app.submitting || !form.valid"
                        @click="submit">
                        Submit
                        <span v-if="app.submitting">ting...</span>
                    </md-button>
                </template>
                
                <template v-else>
                    <md-button
                        v-if="i !== 0"
                        class="md-raised"
                        :disabled="app.submitting"
                        @click="goToSession(i - 1)">
                        <md-icon>chevron_left</md-icon>
                    </md-button>
                    <md-button
                        class="md-raised md-accent"
                        :disabled="(app.submitting || !item.valid) && item.required"
                        @click="goToSession(i + 1)">
                        <md-icon>chevron_right</md-icon>
                    </md-button>
                </template>
            </div>
            
            <div class="md-layout">
                <md-progress-bar 
                    md-mode="determinate" 
                    class="md-accent md-layout-item md-size-50 md-small-size-100" 
                    :md-value=" ((i + 1) / form.items.length) * 100 "></md-progress-bar>
            </div>
        </div>
    </div>
</template>